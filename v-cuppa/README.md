# vCUPPA

vCUPPA is a primary cancer type predictor for panel samples. For WGS samples, please use ![CUPPA](../cuppa/README.md)
instead. vCUPPA employs a convolutional neural network model using ![PURPLE](../purple/README.md) plots.

## Installation

To install, download the latest compiled jar file from the [download links](#version-history-and-download-links).
vCUPPA requires Java 17+ to be installed.

## Usage

Arguments:

| Argument                | Description                                                                                      |
|-------------------------|--------------------------------------------------------------------------------------------------|
| sample                  | Name of the reference sample                                                                     |
| output_dir              | Path to the output directory. This directory will be created if it does not already exist.       |
| purple_dir              | Path to PURPLE output. This should correspond to the output_dir used in PURPLE                   |
| cuppa_data              | Path to CUPPA data file generated by ![CuppaDataPrep](../cuppa/README.md/#Single-sample-example) |
| model                   | Path to the TorchScript model.                                                                   |
| -cuppa_data_definitions | Path to the file that defines the CUPPA features vCUPPA will use.                                |

Example Usage:

```
java -Xmx1G -jar v-cuppa.jar \
   -sample COLO829T \
   -purple_dir /path/to/COLO829/purple \
   -cuppa_data /path/to/COLO829.cuppa_data.tsv.gz \
   -model /path/to/model_scripted.pt \
   -cuppa_data_definitions cuppa_data_def.tsv.gz \
   -output_dir /path/to/COLO829/vchord \
   -log_debug
```

## Output

### vCUPPA prediction file (\<sample\>.vcuppa.prediction.tsv)
The vCUPPA prediction file is a TSV file with the following columns:

| Column                | Description                                          |
|-----------------------|------------------------------------------------------|
| cancerType            | Cancer type                                          |
| probability           | Predicted probability of the cancer type             |

## Algorithm

vCUPPA uses convolutional neural network. model is modified from resnet18[1].

### Model inputs
There are 2 inputs to vCUPPA, they are
* Purple CIRCOS plot. See [purple CIRCOS](../purple/README.md#CIRCOS).
* Cuppa data

## Version History and Download Links
- [0.1](https://github.com/hartwigmedical/hmftools/releases/tag/v-cuppa-v0.1)
  - Handle unpaired reads

## References
1. K. He, X. Zhang, S. Ren and J. Sun, "Deep Residual Learning for Image Recognition,"
  2016 IEEE Conference on Computer Vision and Pattern Recognition (CVPR), Las Vegas, NV, USA, 2016, pp. 770-778, doi: 10.1109/CVPR.2016.90.
